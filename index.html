<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Simulador de Plano de Pagamento</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-dark: #3a56d4;
            --secondary-color: #3f37c9;
            --accent-color: #4895ef;
            --info-color: #007bff;

            --gold-light: #FFD700;
            --gold-dark: #DAA520;
            --dark-background: #1a1a1a;
            --dark-detail: #2c2c2c;
            --light-text: #f0f0f0;
            --grey-detail: #888;

            --danger-color: #f72585;
            --success-color: #4cc9f0;
            --warning-color: #f8961e;

            --border-radius: 12px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--dark-background);
            color: var(--light-text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -webkit-tap-highlight-color: transparent;
        }

        @supports (-webkit-touch-callout: none) {
            body {
                padding-bottom: env(safe-area-inset-bottom);
            }

            input, select, textarea {
                font-size: 16px !important;
            }
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 24px;
            margin-bottom: 24px;
            position: relative;
            z-index: 1;
            border: 3px solid transparent;
            background: linear-gradient(to right, var(--gold-light), var(--success-color), var(--gold-light)) border-box;
            background-size: 200% auto;
            animation: gradientBorder 3s linear infinite;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #333;
            z-index: -1;
            border-radius: var(--border-radius);
        }

        h1, h2, h3, h4 {
            color: var(--gold-light);
            margin-bottom: 16px;
            font-weight: 600;
        }

        h1 {
             font-size: 1.8rem;
             text-align: center;
             margin-bottom: 8px;
             color: var(--gold-light);
        }

        h2 {
            font-size: 1.4rem;
            border-bottom: 2px solid var(--gold-light);
            padding-bottom: 8px;
            margin-top: 24px;
        }

        h3 {
            font-size: 1.2rem;
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--light-text);
            font-size: 0.95rem;
        }

        .highlight-label {
            font-weight: bold;
            color: var(--gold-light);
        }

        .saldo-remanescente-note {
            display: block;
            margin-top: 8px;
            padding: 8px;
            border: 1px solid var(--gold-light);
            border-radius: var(--border-radius);
            background-color: var(--dark-detail);
            font-size: 0.9rem;
            color: var(--light-text);
            word-wrap: break-word;
        }

        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #555;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: #444;
            color: var(--light-text);
            -webkit-appearance: none;
        }

        .form-control:focus {
            border-color: var(--gold-light);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }

        .input-group {
            position: relative;
            display: flex;
            align-items: center;
        }

        .result-card {
            background-color: var(--dark-detail);
            border-radius: var(--border-radius);
            padding: 16px;
            margin-top: 16px;
            border-left: 4px solid var(--gold-light);
            color: var(--light-text);
        }

        .result-card p {
            margin: 8px 0;
            font-size: 1rem;
        }

        .result-card p:has(.saldo-remanescente-note) {
             margin-bottom: 0;
        }

        .result-card strong {
            color: var(--gold-light);
        }

        .divider {
            height: 1px;
            background-color: #555;
            margin: 24px 0;
            border: none;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            font-weight: 500;
            font-size: 1rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            width: 100%;
            margin-bottom: 12px;
        }
        
        .btn.btn-auto-width {
            width: auto;
            padding: 12px;
            flex-shrink: 0;
        }
        
        .btn-auto-width i {
             margin-right: 0 !important;
        }

        .btn-primary {
            background-color: var(--gold-light);
            color: var(--dark-background);
        }

        .btn-primary:hover {
            background-color: var(--gold-dark);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background-color: #555;
            color: var(--light-text);
        }

        .btn-secondary:hover {
            background-color: #666;
            transform: translateY(-1px);
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #d1145a;
            transform: translateY(-1px);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #3ab7d8;
            transform: translateY(-1px);
        }

        .btn-warning {
            background-color: var(--gold-dark);
            color: var(--dark-background);
        }

        .btn-warning:hover {
            background-color: var(--gold-light);
            transform: translateY(-1px);
        }

        .btn-whatsapp {
            background-color: #25D366;
            color: white;
        }

        .btn-whatsapp:hover {
            background-color: #1DA851;
            transform: translateY(-1px);
        }

        .btn-whatsapp i {
             margin-right: 0;
        }
        
        .btn-info {
            background-color: var(--info-color);
            color: white;
        }
        
        .btn-info:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
        }

        .btn i {
            margin-right: 8px;
        }
        
        .btn .btn-text {
            margin-left: 0px;
        }
        
        #leadCount {
            margin-left: 5px;
            font-size: 0.9em;
            font-weight: 700;
            color: var(--gold-light);
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 24px;
        }
        
        .backup-btn-group {
            margin-top: 12px;
        }
        
        .top-button-container {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .top-button-container #btnAbrirListaLeads {
            margin-right: auto;
        }
        
        .top-button-container .btn {
            margin-bottom: 0;
        }
        
        .top-button-container .btn-calculator {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            border-radius: var(--border-radius);
            font-weight: 500;
            font-size: 1rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            text-decoration: none;
            width: auto;
            flex-shrink: 0;
            background-color: var(--gold-light);
            color: var(--dark-background);
        }
        
        .top-button-container .btn-calculator:hover {
            background-color: var(--gold-dark);
            transform: translateY(-1px);
        }
        
        .top-button-container .btn-calculator i {
            margin-right: 0;
        }

        .history-section {
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid #555;
        }

        .history-item {
            background-color: #333;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--box-shadow);
            position: relative;
            color: var(--light-text);
            word-wrap: break-word;
        }

        .history-item h4 {
            color: var(--gold-light);
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1rem;
        }

        .history-item p {
            margin: 4px 0;
            font-size: 0.95rem;
        }

        .history-item .note-content {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #555;
            font-style: italic;
            color: var(--grey-detail);
        }

        .history-item .badge {
            background-color: var(--gold-light);
            color: var(--dark-background);
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .history-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 16px;
        }

        .history-actions .btn {
            width: calc(50% - 6px);
            margin-bottom: 0;
            padding: 10px;
            font-size: 0.9rem;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--grey-detail);
        }

        .empty-state i {
            font-size: 2.5rem;
            color: #555;
            margin-bottom: 16px;
        }

        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-color: var(--dark-detail);
            color: var(--gold-light);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 100;
            transition: var(--transition);
            border: none;
            cursor: pointer;
            display: none;
        }

        .fab:hover {
            transform: scale(1.1);
            background-color: #444;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        #confirmationModal {
             z-index: 1010;
        }

        #documentsModal {
            z-index: 1005;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background-color: var(--dark-background);
            border-radius: var(--border-radius);
            padding: 24px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.3s ease;
            color: var(--light-text);
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #555;
            padding-bottom: 15px;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--gold-light);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--grey-detail);
        }

        #historyList {
            margin-top: 20px;
        }

        #documentsModal .document-header-info {
            margin-bottom: 20px;
        }
        
        #documentsModal .document-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #444;
        }
        
        #documentsModal .document-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        #documentsModal .document-section h4 {
            color: var(--gold-light);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        #documentsModal .document-section ul {
            list-style-type: none;
            padding-left: 0;
        }
        
        #documentsModal .document-section ul li {
            margin-bottom: 8px;
            font-size: 0.95rem;
            display: flex;
            align-items: flex-start;
        }
        
        #documentsModal .document-section ul li i {
            margin-right: 10px;
            color: var(--success-color);
            font-size: 1.1rem;
            margin-top: 2px;
        }
        
        #documentsModal .developer-info-modal {
            margin-top: 20px;
            font-size: 0.85rem;
            color: var(--grey-detail);
            text-align: center;
        }

        #documentsModal .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: space-around;
        }
        
        #documentsModal .modal-buttons .btn {
            flex-grow: 1;
            width: auto;
            margin-bottom: 0;
        }
        
        #documentsModal .modal-buttons .btn i {
            margin-right: 5px;
        }

        #documentsModal .editable-header-info {
            background-color: var(--dark-detail);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 20px;
            color: var(--light-text);
        }
        
        #documentsModal .editable-header-info .form-group {
            margin-bottom: 15px;
        }
        
        #documentsModal .editable-header-info .form-group:last-child {
            margin-bottom: 0;
        }
        
        #documentsModal .editable-header-info label {
            font-size: 0.9rem;
            font-weight: normal;
            color: var(--grey-detail);
        }
        
        #documentsModal .editable-header-info input.form-control {
            padding: 10px 12px;
            font-size: 0.95rem;
            background-color: #383838;
        }

        #documentsModal .profession-selector {
            margin-bottom: 20px;
        }
        
        #documentsModal .profession-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--light-text);
        }
        
        #documentsModal .profession-selector select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #555;
            border-radius: var(--border-radius);
            font-size: 1rem;
            background-color: #444;
            color: var(--light-text);
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23FFD700' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
        }
        
        #documentsModal .profession-selector select:focus {
            border-color: var(--gold-light);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }

        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            .card {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            h2 {
                font-size: 1.2rem;
            }
            
            .btn-group {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .history-actions {
                flex-direction: column;
            }
            
            .history-actions .btn {
                width: 100%;
                margin-bottom: 8px;
            }
            
            .footer {
                padding: 20px 10px;
            }
            
            .btn-whatsapp {
                display: flex;
                flex-direction: row;
                align-items: center;
                justify-content: center;
            }
            
            .btn-whatsapp i {
                margin-right: 5px;
            }
            
            #notasSection .btn-group {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .top-button-container {
                flex-direction: row;
                gap: 5px;
                justify-content: space-around;
                flex-wrap: wrap;
            }
            
            .top-button-container .btn {
                width: auto;
                margin-bottom: 0;
                padding: 8px 10px;
            }
            
            .btn-auto-width {
                width: auto !important;
            }
            
            .top-button-container .btn-auto-width:not(:has(.btn-text)) {
                padding: 8px;
                width: auto !important;
            }
            
            .top-button-container #btnAbrirListaLeads {
                margin-right: auto;
            }

            #documentsModal .modal-buttons {
                flex-direction: column;
                gap: 8px;
            }
        }

        @media (min-width: 768px) {
            .container {
                max-width: 700px;
                padding: 24px;
            }
            
            .btn-group {
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }
            
            .btn-whatsapp i {
                margin-right: 8px;
            }
            
            #notasSection .btn-group {
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }
            
            .history-actions {
                flex-direction: row;
            }
            
            .top-button-container {
                flex-direction: row;
                align-items: center;
                gap: 10px;
            }
            
            .top-button-container .btn-auto-width {
                width: auto;
            }
            
            .top-button-container .btn-auto-width:not(:has(.btn-text)) {
                padding: 12px;
                width: auto;
            }
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            padding: 12px 24px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 2000;
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            max-width: 90%;
            text-align: center;
            background-color: var(--dark-detail);
            color: var(--light-text);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .toast-error {
            background-color: var(--danger-color);
            color: white;
        }
        
        .toast-warning {
            background-color: var(--gold-dark);
            color: var(--dark-background);
        }

        .top-links {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }

        #blogLink {
            font-weight: bold;
            text-decoration: none;
            color: var(--light-text);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            z-index: 1;
            border: 2px solid transparent;
            background: linear-gradient(to right, var(--gold-light), var(--success-color), var(--gold-light)) border-box;
            background-size: 200% auto;
            animation: gradientBorder 3s linear infinite;
            overflow: hidden;
        }

        #blogLink::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--dark-detail);
            z-index: -1;
            border-radius: var(--border-radius);
        }

        #blogLink:hover {
            transform: translateY(-1px);
            text-decoration: none;
        }

        #blogLink i {
            margin-right: 0;
            color: var(--light-text);
        }

        .footer {
            margin-top: 40px;
            padding: 30px 20px;
            background-color: var(--dark-detail);
            text-align: center;
            color: var(--light-text);
            font-size: 0.9rem;
            border-top: 1px solid #555;
        }
        
        .footer p {
            margin: 5px 0;
        }
        
        .footer .developer-info {
            font-weight: 500;
        }
        
        .footer .whatsapp-icon {
            color: #25D366;
            font-size: 1.5rem;
            margin-top: 10px;
            display: block;
        }

        .marquee-text {
            font-size: 0.8rem;
            color: var(--grey-detail);
            display: block;
        }

        #secaoListaLeads h2 {
            color: var(--gold-light);
            border-bottom: none;
            margin-bottom: 0;
        }
        
        #tabelaLeads {
            color: var(--light-text);
            border: 1px solid #555;
            margin-top: 20px;
            width: 100%;
            display: table;
            border-collapse: collapse;
        }
        
        #tabelaLeads th, #tabelaLeads td {
            border: 1px solid #555;
            padding: 10px;
            text-align: left;
            vertical-align: top;
            word-break: break-word;
            flex-grow: 1;
            flex-basis: 0;
        }
        
        #tabelaLeads th:nth-child(1) { width: 10%; }
        #tabelaLeads th:nth-child(2) { width: 10%; }
        #tabelaLeads th:nth-child(3) { width: 10%; }
        #tabelaLeads th:nth-child(4) { width: 8%; }
        #tabelaLeads th:nth-child(5) { width: 8%; }
        #tabelaLeads th:nth-child(6) { width: 8%; }
        #tabelaLeads th:nth-child(7) { width: 8%; }
        #tabelaLeads th:nth-child(8) { width: 12%; }
        #tabelaLeads th:nth-child(9) { width: 18%; text-align: left;}
        #tabelaLeads th:nth-child(10) { width: 8%; text-align: center;}

        #tabelaLeads th {
            background-color: var(--dark-detail);
            color: var(--gold-light);
        }
        
        #tabelaLeads tbody tr:nth-child(even) {
            background-color: #2c2c2c;
        }
        
        #tabelaLeads tbody tr:hover {
            background-color: #444;
        }
        
        #tabelaLeads .btn-danger i {
            margin-right: 0;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #btnNovaSimulacao i.fas.fa-sync-alt {
            animation: spin 2s linear infinite;
        }

        @keyframes iconBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        @keyframes borderGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.4), 0 0 10px rgba(255, 215, 0, 0.2); border-color: var(--gold-light); }
            50% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.8), 0 0 20px rgba(255, 215, 0, 0.4); border-color: var(--gold-dark); }
        }

        @keyframes gradientBorder {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #btnAbrirListaLeads {
            animation: borderGlow 2s infinite alternate;
            border: 2px solid transparent;
            padding: 10px;
            position: relative;
            z-index: 1;
            background-clip: padding-box;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #btnAbrirListaLeads i {
            animation: iconBlink 1.5s infinite alternate;
            margin-right: 5px;
        }
        
        @media (max-width: 768px) {
            .top-button-container .btn-auto-width#btnAbrirListaLeads i {
                margin-right: 5px !important;
            }
        }

        #btnDocumentos {
            position: relative;
            z-index: 1;
            padding: 10px;
            overflow: hidden;
            border: 2px solid transparent;
            background: linear-gradient(to right, var(--gold-light), var(--success-color), var(--gold-light)) border-box;
            background-size: 200% auto;
            animation: gradientBorder 3s linear infinite;
        }

        #btnDocumentos::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--dark-detail);
            z-index: -1;
            border-radius: var(--border-radius);
        }

        #btnDocumentos i {
            margin-right: 0 !important;
            color: var(--light-text);
        }

        #partyEffectContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            pointer-events: none;
            overflow: hidden;
            opacity: 0;
            transition: opacity 0.5s ease;
            background-color: rgba(0, 0, 0, 0.5);
        }

        #partyEffectContainer.show {
            opacity: 1;
        }

        #partyMessage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 2.5em;
            font-weight: bold;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            z-index: 10;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #partyEffectContainer.show #partyMessage {
            opacity: 1;
        }

        .balloon {
            position: absolute;
            bottom: -100px;
            width: 50px;
            height: 60px;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            opacity: 0.8;
            animation: floatUp 10s ease-in infinite;
            z-index: 1;
        }

        .balloon::after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 1px;
            height: 20px;
            background-color: rgba(255, 255, 255, 0.5);
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 0.8;
            }
            50% {
                transform: translateY(-50vh) rotate(5deg);
                opacity: 0.9;
            }
            100% {
                transform: translateY(-110vh) rotate(-5deg);
                opacity: 0;
            }
        }

        .confetti {
            position: absolute;
            width: 8px;
            height: 12px;
            background-color: white;
            opacity: 0.7;
            animation: fallAndRotate 8s linear infinite;
            z-index: 0;
        }

        @keyframes fallAndRotate {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 0.7;
            }
            100% {
                transform: translateY(110vh) rotate(720deg);
                opacity: 0.5;
            }
        }

        /* Estilo para o indicador de INCC */
        .incc-indicator {
            background-color: var(--dark-detail);
            border-radius: var(--border-radius);
            padding: 10px 15px;
            margin-top: 10px;
            border-left: 4px solid var(--success-color);
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .incc-indicator .incc-value {
            color: var(--success-color);
            font-weight: bold;
            font-size: 1rem;
        }

        .incc-indicator .incc-update-time {
            color: var(--grey-detail);
            font-size: 0.8rem;
            text-align: right;
        }

        .incc-loading {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid var(--grey-detail);
            border-top: 2px solid var(--success-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 5px;
        }

        /* Botão de download PDF */
        #btnBaixarResumoPDF {
            position: relative;
            z-index: 1;
            padding: 10px;
            overflow: hidden;
            border: 2px solid transparent;
            background: linear-gradient(to right, var(--gold-light), var(--success-color), var(--gold-light)) border-box;
            background-size: 200% auto;
            animation: gradientBorder 3s linear infinite;
        }

        #btnBaixarResumoPDF::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--dark-detail);
            z-index: -1;
            border-radius: var(--border-radius);
        }

        #btnBaixarResumoPDF i {
            margin-right: 0 !important;
            color: var(--light-text);
        }

        /* Botão para baixar lista de leads em PDF */
        #btnBaixarListaLeadsPDF {
            position: relative;
            z-index: 1;
            padding: 10px;
            overflow: hidden;
            border: 2px solid transparent;
            background: linear-gradient(to right, var(--success-color), var(--gold-light), var(--success-color)) border-box;
            background-size: 200% auto;
            animation: gradientBorder 3s linear infinite;
        }

        #btnBaixarListaLeadsPDF::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--dark-detail);
            z-index: -1;
            border-radius: var(--border-radius);
        }

        #btnBaixarListaLeadsPDF i {
            margin-right: 0 !important;
            color: var(--light-text);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-links"></div>

        <div class="card" id="simuladorCard">
            <div class="top-button-container">
                <button id="btnAbrirListaLeads" class="btn btn-secondary btn-auto-width" title="Ver Leads Salvos">
                    <i class="fas fa-users"></i>
                    <span id="leadCount">0</span>
                </button>
                <button id="btnNovaSimulacao" class="btn btn-primary btn-auto-width" title="Nova Simulação">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button id="btnDocumentos" class="btn btn-secondary btn-auto-width" title="Ver Documentos Necessários">
                    <i class="fas fa-file-alt"></i>
                </button>
                <a href="https://www.portaldeempreendimentos.caixa.gov.br/simulador/" target="_blank" class="btn btn-primary btn-auto-width btn-calculator" title="Abrir Simulador Caixa">
                    <i class="fas fa-calculator"></i>
                </a>
                <a href="https://dinheiroeplanejamento.blogspot.com/2025/04/guia-completo-para-corretores-de.html" target="_blank" id="blogLink" title="Acesse o Blog">
                    <i class="fas fa-book"></i>
                </a>
                <!-- NOVO BOTÃO PARA BAIXAR RESUMO PDF -->
                <button id="btnBaixarResumoPDF" class="btn btn-success btn-auto-width" title="Baixar Resumo PDF">
                    <i class="fas fa-file-pdf"></i>
                </button>
            </div>

            <div class="form-group" id="form-group-nomeEmpreendimento">
                <label for="nomeEmpreendimento" class="highlight-label">Empreendimento</label>
                <input type="text" id="nomeEmpreendimento" class="form-control" placeholder="Ex: Residencial Jardins">
            </div>
            <div class="form-group" id="form-group-nomeCliente">
                <label for="nomeCliente" class="highlight-label">Nome do Cliente!</label>
                <input type="text" id="nomeCliente" class="form-control" placeholder="Ex: João Silva">
            </div>

            <div class="form-group" id="form-group-telefoneCliente">
                <label for="telefoneCliente" class="highlight-label">Telefone do Cliente</label>
                <input type="text" id="telefoneCliente" class="form-control" placeholder="(00) 99999-9999">
            </div>

            <!-- INDICADOR DE INCC ATUAL -->
            <div class="incc-indicator" id="inccIndicator">
                <div>
                    <strong>INCC Atual:</strong> 
                    <span id="inccCurrentValue">Carregando...</span>
                    <span class="incc-loading" id="inccLoading"></span>
                </div>
                <div class="incc-update-time" id="inccUpdateTime"></div>
            </div>

            <div class="divider"></div>
            <h3>Plano de Pagamento</h3> <div class="divider"></div>

            <div class="form-group" id="form-group-valorImovel">
                <label for="valorImovel">Valor do Imóvel (Tabela,Construtora)</label>
                <div class="input-group">
                    <input type="text" id="valorImovel" class="form-control currency-input" value="0,00">
                </div>
            </div>

            <div class="form-group" id="form-group-descontoMCMV">
                <label for="descontoMCMV">Desconto (Subsídio)</label>
                <div class="input-group">
                    <input type="text" id="descontoMCMV" class="form-control currency-input" value="0,00">
                </div>
            </div>

            <div class="form-group" id="form-group-valorFinanciado">
                <label for="valorFinanciado">Valor Financiado (Caixa)</label>
                <div class="input-group">
                    <input type="text" id="valorFinanciado" class="form-control currency-input" value="0,00">
                </div>
            </div>

            <div class="form-group" id="form-group-valorFGTS">
                <label for="valorFGTS">FGTS (se houver)</label>
                <div class="input-group">
                    <input type="text" id="valorFGTS" class="form-control currency-input" value="0,00">
                </div>
            </div>

            <div class="divider"></div>

            <h3>(Sinal, Decontos, Parcelamento)</h3> <div class="form-group" id="form-group-sinalConstrutora">
                <label for="sinalConstrutora">Sinal para a Construtora</label>
                <div class="input-group">
                    <input type="text" id="sinalConstrutora" class="form-control currency-input" value="0,00">
                </div>
            </div>

            <div class="form-group" id="form-group-descontoConstrutora">
                <label for="descontoConstrutora">Desconto da Construtora</label>
                <div class="input-group">
                    <input type="text" id="descontoConstrutora" class="form-control currency-input" value="0,00">
                </div>
            </div>

            <div class="form-group" id="form-group-maximoConstrParc">
                <label for="maximoConstrParc">Máximo que a Construtora Parcela</label>
                <div class="input-group">
                    <input type="text" id="maximoConstrParc" class="form-control currency-input" value="0,00">
                </div>
            </div>

            <div class="form-group" id="form-group-parcelasEntrada">
                <label for="parcelasEntrada">Quantidade de Parcelas</label>
                <input type="number" id="parcelasEntrada" class="form-control" step="1" value="1" inputmode="numeric">
            </div>

            <div class="form-group" id="form-group-correcaoINCC">
                <label for="correcaoINCC">% de correção mensal (INCC)</label>
                <div class="input-group">
                    <span class="prefix">%</span>
                    <input type="number" id="correcaoINCC" class="form-control" step="0.01" value="0" inputmode="decimal">
                </div>
                <p style="font-size: 0.85rem; color: var(--grey-detail); margin-top: 5px;">
                    <i class="fas fa-info-circle"></i> O valor das parcelas de entrada é corrigido mensalmente pelo INCC e após a obra pelo IPCA mais 1%.
                </p>
            </div>

            <div class="divider"></div>
            <h3>Intercaladas</h3> <div class="divider"></div>

            <div class="form-group" id="form-group-valorIntercaladas">
                <label for="valorIntercaladas">Valor das Intercaladas</label>
                <div class="input-group">
                    <input type="text" id="valorIntercaladas" class="form-control currency-input" value="0,00">
                </div>
            </div>

            <div class="form-group" id="form-group-quantidadeIntercaladas">
                <label for="quantidadeIntercaladas">Quantidade de Intercaladas</label>
                <input type="number" id="quantidadeIntercaladas" class="form-control" step="1" value="0" inputmode="numeric">
            </div>

            <div class="result-card">
                <p><strong>Total de Intercaladas:</strong> <span id="totalIntercaladas">R$ 0,00</span></p>
            </div>

            <div class="result-card">
                <p><strong>Saldo Remanescente:</strong> <span id="saldoRemanescente">R$ 0,00</span></p>
            </div>

            <div class="result-card">
                <p><strong>Valor da Entrada Parcelado:</strong> <span id="valorParcelaEntradaInicial">R$ 0,00</span></p>
                <p style="font-size: 0.9rem; color: var(--grey-detail);">
                    <i class="fas fa-info-circle"></i> O valor das parcelas de entrada é corrigido mensalmente pelo INCC e após a obra pelo IPCA mais 1%.
                </p>
            </div>

            <div class="form-group" id="form-group-observacoesCliente">
                <label for="observacoesCliente">Observações:</label>
                <textarea id="observacoesCliente" class="form-control" rows="4" placeholder="Adicionar observações sobre esta simulação ou cliente..."></textarea>
            </div>
            <button id="toggleNotasBtn" class="btn btn-secondary" style="margin-bottom: 12px;">
                <i class="fas fa-clipboard"></i><span class="btn-text"> Notas Restritas</span>
            </button>

            <div class="btn-group">
                <button id="baixarSimulacaoAtualBtn" class="btn btn-warning"> <i class="fas fa-file-alt"></i> Baixar TXT
                </button>
                <button id="enviarWhatsappBtn" class="btn btn-whatsapp">
                    <i class="fab fa-whatsapp"></i> WhatsApp
                </button>
            </div>

            <div class="btn-group backup-btn-group">
                <button id="btnExportarBackup" class="btn btn-info">
                    <i class="fas fa-upload"></i> Exportar Backup
                </button>
                <button id="btnImportarBackup" class="btn btn-info">
                    <i class="fas fa-download"></i> Importar Backup
                </button>
                <input type="file" id="importFile" accept=".json" style="display: none;">
            </div>

            <div id="notasSection" style="display: none; margin-top: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>Notas do Cliente</h3>
                    <button id="openHistoryBtn" class="btn btn-secondary btn-auto-width" style="margin-bottom: 10px; padding: 8px 12px; font-size: 0.9rem;">
                        <i class="fas fa-history"></i> Histórico
                    </button>
                </div>

                <div class="form-group">
                    <label for="notasCliente">Escreva suas notas aqui:</label>
                    <textarea id="notasCliente" class="form-control" rows="6" placeholder="Adicionar notas sobre o cliente ou simulação..."></textarea>
                </div>
                <div class="btn-group"> <button id="salvarNotasBtn" class="btn btn-success">
                        <i class="fas fa-save"></i> Salvar Notas
                    </button>
                    <button id="baixarNotasBtn" class="btn btn-secondary">
                        <i class="fas fa-download"></i> Baixar Notas
                    </button>
                </div>
            </div>
        </div>

        <div id="secaoListaLeads" class="card" style="display: none; margin-top: 30px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom:15px;">
                <h2><i class="fas fa-users"></i> Lista de Leads</h2>
                <div style="display: flex; gap: 10px;">
                    <button id="btnImportarLeadsCSV" class="btn btn-info btn-auto-width" style="margin-bottom:0;">
                        <i class="fas fa-file-csv"></i> Importar CSV
                    </button>
                    <input type="file" id="importLeadsCSVFile" accept=".csv" style="display: none;">
                    <button id="btnImportarLeads" class="btn btn-success btn-auto-width" style="margin-bottom:0;">
                        <i class="fas fa-file-import"></i> Importar JSON
                    </button>
                    <input type="file" id="importLeadsFile" accept=".json" style="display: none;">

                    <button id="btnBaixarListaLeads" class="btn btn-primary btn-auto-width" style="margin-bottom:0;">
                        <i class="fas fa-download"></i> Baixar Lista
                    </button>
                    <!-- NOVO BOTÃO PARA BAIXAR LISTA DE LEADS EM PDF -->
                    <button id="btnBaixarListaLeadsPDF" class="btn btn-success btn-auto-width" style="margin-bottom:0;">
                        <i class="fas fa-file-pdf"></i> Baixar PDF
                    </button>
                </div>
            </div>
            <div style="max-height: 400px; overflow-y: auto;">
                <table id="tabelaLeads" class="form-control" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background-color: var(--dark-detail);">
                            <th style="padding: 10px; border: 1px solid #555; text-align: left;">Nome</th>
                            <th style="padding: 10px; border: 1px solid #555; text-align: left;">Telefone</th>
                            <th style="padding: 10px; border: 1px solid #555; text-align: left;">Imóvel</th>
                            <th style="padding: 10px; border: 1px solid #555; text-align: left;">Data</th>
                            <th style="padding: 10px; border: 1px solid #555; text-align: left;">Subsídio</th>
                            <th style="padding: 10px; border: 1px solid #555; text-align: left;">Financiado</th>
                            <th style="padding: 10px; border: 1px solid #555; text-align: left;">FGTS</th>
                            <th style="padding: 10px; border: 1px solid #555; text-align: left;">Notas</th>
                            <th style="padding: 10px; border: 1px solid #555; text-align: left;">Observações</th>
                            <th style="padding: 10px; border: 1px solid #555; text-align: center;">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="corpoTabelaLeads"></tbody>
                </table>
                <p id="semLeadsMensagem" style="text-align: center; padding: 20px; display: none;">Nenhum lead salvo ainda.</p>
            </div>
            <button id="btnVoltarSimulador" class="btn btn-secondary btn-auto-width" style="margin-top: 20px;">
                <i class="fas fa-arrow-left"></i> Voltar para Simulador
            </button>
        </div>

    </div>

    <button class="fab" id="scrollToTopBtn">
        <i class="fas fa-arrow-up"></i>
    </button>

    <div class="modal" id="confirmationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Confirmação</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div id="modalMessage">
                Tem certeza que deseja realizar esta ação?
            </div>
            <div class="btn-group" style="margin-top: 20px;"> <button id="modalCancelBtn" class="btn btn-secondary">Cancelar</button>
                <button id="modalConfirmBtn" class="btn btn-danger">Confirmar</button>
            </div>
        </div>
    </div>

    <div class="modal" id="historyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Histórico de Notas</h3>
                <button class="close-modal" data-target="#historyModal">&times;</button>
            </div>
            <div id="historyList">
                <div class="empty-state" id="emptyHistoryMessage" style="display: none;">
                    <i class="fas fa-box-open"></i>
                    <p>Nenhuma nota salva ainda.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="documentsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Documentos para Simulação</h3>
                <button class="close-modal" data-target="#documentsModal">&times;</button>
            </div>
            <div class="modal-body" id="documentsModalBody">
                <div class="editable-header-info">
                    <div class="form-group">
                        <label for="imobiliariaNome">Nome da Imobiliária</label>
                        <input type="text" id="imobiliariaNome" class="form-control" placeholder="Ex: Imobiliária">
                    </div>
                    <div class="form-group">
                        <label for="corretorNome">Nome do Corretor</label>
                        <input type="text" id="corretorNome" class="form-control" placeholder="Ex: Corretor">
                    </div>
                    <div class="form-group">
                        <label for="corretorCreci">CRECI do Corretor</label>
                        <input type="text" id="corretorCreci" class="form-control" placeholder="Ex: CRECI/AL 5794">
                    </div>
                </div>

                <div class="profession-selector">
                    <label for="profissaoCliente">Profissão do Cliente</label>
                    <select id="profissaoCliente" class="form-control">
                        <option value="carteira-assinada">Carteira Assinada</option>
                        <option value="servidor-publico">Servidor Público</option>
                        <option value="empresario">Empresário</option>
                        <option value="forcas-armadas">Forças Armadas</option>
                        <option value="autonomo">Autônomo</option>
                        <option value="motorista-aplicativo">Motorista de Aplicativo</option>
                        <option value="pensionista">Pensionista</option>
                    </select>
                </div>

                <div class="document-header-info" id="pdfHeaderInfo">
                    <h2 style="color: #333; text-align: center; margin-bottom: 10px; font-size: 1.5rem;"></h2>
                    <p style="text-align: center; color: #555; font-size: 0.9rem; margin-bottom: 20px;"> -</p>
                </div>

                <div id="documentosContainer">
                    <!-- Conteúdo dos documentos será carregado aqui dinamicamente -->
                </div>
            </div>
            <div class="modal-buttons">
                <button id="baixarDocumentosPdfBtn" class="btn btn-secondary">
                    <i class="fas fa-file-pdf"></i> Baixar PDF
                </button>
                <button id="baixarDocumentosTxtBtn" class="btn btn-secondary">
                    <i class="fas fa-file-alt"></i> Baixar TXT
                </button>
                <button id="enviarDocumentosWhatsappBtn" class="btn btn-whatsapp">
                    <i class="fab fa-whatsapp"></i> Enviar WhatsApp
                </button>
            </div>
            <p class="developer-info-modal">Desenvolvedor - Alex Peixoto - (82) 996622036</p>
        </div>
    </div>

    <div id="partyEffectContainer">
        <div id="partyMessage">Parabéns! Continue assim!</div>
    </div>
    
    <footer class="footer">
        <p class="developer-info">Desenvolvedor - Alex Peixoto - (82) 996622036</p>
        <p class="marquee-text">Solicite seu sistema CRM</p>
        <a href="https://wa.me/5582996622036" target="_blank" class="whatsapp-icon">
            <i class="fab fa-whatsapp"></i>
        </a>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        const { jsPDF } = window.jspdf;

        // Variáveis existentes
        const valorImovelInput = document.getElementById('valorImovel');
        const descontoMCMVInput = document.getElementById('descontoMCMV');
        const valorFinanciadoInput = document.getElementById('valorFinanciado');
        const descontoConstrutoraInput = document.getElementById('descontoConstrutora');
        const valorFGTSInput = document.getElementById('valorFGTS');
        const sinalConstrutoraInput = document.getElementById('sinalConstrutora');
        const maximoConstrParcInput = document.getElementById('maximoConstrParc');
        const saldoRemanescenteSpan = document.getElementById('saldoRemanescente');
        const parcelasEntradaInput = document.getElementById('parcelasEntrada');
        const valorParcelaEntradaInicialSpan = document.getElementById('valorParcelaEntradaInicial');
        const correcaoINCCInput = document.getElementById('correcaoINCC');
        const nomeEmpreendimentoInput = document.getElementById('nomeEmpreendimento');
        const nomeClienteInput = document.getElementById('nomeCliente');
        const telefoneClienteInput = document.getElementById('telefoneCliente');
        const baixarSimulacaoAtualBtn = document.getElementById('baixarSimulacaoAtualBtn');
        const enviarWhatsappBtn = document.getElementById('enviarWhatsappBtn');
        const scrollToTopBtn = document.getElementById('scrollToTopBtn');
        const confirmationModal = document.getElementById('confirmationModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalCancelBtn = document.getElementById('modalCancelBtn');
        const modalConfirmBtn = document.getElementById('modalConfirmBtn');
        const closeModalBtns = document.querySelectorAll('.close-modal');
        const toggleNotasBtn = document.getElementById('toggleNotasBtn');
        const notasSection = document.getElementById('notasSection');
        const notasClienteTextArea = document.getElementById('notasCliente');
        const observacoesClienteTextArea = document.getElementById('observacoesCliente');
        const baixarNotasBtn = document.getElementById('baixarNotasBtn');
        const salvarNotasBtn = document.getElementById('salvarNotasBtn');
        const openHistoryBtn = document.getElementById('openHistoryBtn');
        const historyModal = document.getElementById('historyModal');
        const historyList = document.getElementById('historyList');
        const emptyHistoryMessage = document.getElementById('emptyHistoryMessage');
        const currencyInputs = document.querySelectorAll('.currency-input');
        const btnNovaSimulacao = document.getElementById('btnNovaSimulacao');
        const btnExportarBackup = document.getElementById('btnExportarBackup');
        const btnImportarBackup = document.getElementById('btnImportarBackup');
        const importFileInput = document.getElementById('importFile');
        const blogLink = document.getElementById('blogLink');
        const btnAbrirListaLeads = document.getElementById('btnAbrirListaLeads');
        const secaoListaLeads = document.getElementById('secaoListaLeads');
        const corpoTabelaLeads = document.getElementById('corpoTabelaLeads');
        const btnBaixarListaLeads = document.getElementById('btnBaixarListaLeads');
        const semLeadsMensagem = document.getElementById('semLeadsMensagem');
        const btnVoltarSimulador = document.getElementById('btnVoltarSimulador');
        const simuladorCardElement = document.getElementById('simuladorCard');
        const tabelaLeadsElement = document.getElementById('tabelaLeads');
        const leadCountSpan = document.getElementById('leadCount');
        const btnImportarLeadsCSV = document.getElementById('btnImportarLeadsCSV');
        const importLeadsCSVFileInput = document.getElementById('importLeadsCSVFile');
        const btnImportarLeads = document.getElementById('btnImportarLeads');
        const importLeadsFileInput = document.getElementById('importLeadsFile');
        const btnDocumentos = document.getElementById('btnDocumentos');
        const documentsModal = document.getElementById('documentsModal');
        const enviarDocumentosWhatsappBtn = document.getElementById('enviarDocumentosWhatsappBtn');
        const baixarDocumentosPdfBtn = document.getElementById('baixarDocumentosPdfBtn');
        const documentsModalBody = document.getElementById('documentsModalBody');
        const pdfHeaderInfo = document.getElementById('pdfHeaderInfo');
        const imobiliariaNomeInput = document.getElementById('imobiliariaNome');
        const corretorNomeInput = document.getElementById('corretorNome');
        const corretorCreciInput = document.getElementById('corretorCreci');
        const baixarDocumentosTxtBtn = document.getElementById('baixarDocumentosTxtBtn');
        const partyEffectContainer = document.getElementById('partyEffectContainer');
        const partyMessage = document.getElementById('partyMessage');
        const profissaoClienteSelect = document.getElementById('profissaoCliente');
        const documentosContainer = document.getElementById('documentosContainer');
        const valorIntercaladasInput = document.getElementById('valorIntercaladas');
        const quantidadeIntercaladasInput = document.getElementById('quantidadeIntercaladas');
        const totalIntercaladasSpan = document.getElementById('totalIntercaladas');
        const btnBaixarResumoPDF = document.getElementById('btnBaixarResumoPDF');
        const btnBaixarListaLeadsPDF = document.getElementById('btnBaixarListaLeadsPDF');

        // NOVAS VARIÁVEIS PARA INCC
        const inccIndicator = document.getElementById('inccIndicator');
        const inccCurrentValue = document.getElementById('inccCurrentValue');
        const inccLoading = document.getElementById('inccLoading');
        const inccUpdateTime = document.getElementById('inccUpdateTime');

        // Funções utilitárias
        function formatCurrencyDisplay(value) {
            if (isNaN(value)) return 'R$ 0,00';
            return 'R$ ' + value.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }

        function cleanCurrencyFormat(value) {
            if (!value) return 0;
            const cleaned = value.toString()
                .replace('R$', '')
                .replace(/\./g, '')
                .replace(',', '.')
                .trim();
            const num = parseFloat(cleaned);
            return isNaN(num) ? 0 : num;
        }

        function formatInputAsCurrency(event) {
            const input = event.target;
            let value = input.value.replace(/\D/g, '');
            if (value === '') {
                input.value = '0,00';
                return;
            }
            
            const intValue = parseInt(value, 10);
            const formatted = (intValue / 100).toFixed(2);
            
            // Adicionar separadores de milhar
            const parts = formatted.split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            input.value = 'R$ ' + parts.join(',');
            
            calcularValores();
        }

        function formatPhoneNumberForOutput(phone) {
            if (!phone) return 'Não Informado';
            const cleaned = phone.replace(/\D/g, '');
            if (cleaned.length === 11) {
                return `(${cleaned.substring(0,2)}) ${cleaned.substring(2,7)}-${cleaned.substring(7)}`;
            } else if (cleaned.length === 10) {
                return `(${cleaned.substring(0,2)}) ${cleaned.substring(2,6)}-${cleaned.substring(6)}`;
            }
            return phone;
        }

        function formatInputAsPhone(event) {
            const input = event.target;
            let value = input.value.replace(/\D/g, '');
            
            if (value.length > 11) {
                value = value.substring(0, 11);
            }
            
            if (value.length > 10) {
                value = value.replace(/^(\d{2})(\d{5})(\d{4}).*/, '($1) $2-$3');
            } else if (value.length > 6) {
                value = value.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, '($1) $2-$3');
            } else if (value.length > 2) {
                value = value.replace(/^(\d{2})(\d{0,5})/, '($1) $2');
            } else if (value.length > 0) {
                value = value.replace(/^(\d{0,2})/, '($1');
            }
            
            input.value = value;
        }

        function showToast(message, type = 'info', duration = 3000) {
            // Remove toast existente
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            // Cria novo toast
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // Mostra toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // Remove toast após duração
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 300);
            }, duration);
        }

        function calcularIntercaladas() {
            const valorIntercaladas = cleanCurrencyFormat(valorIntercaladasInput.value) || 0;
            const quantidadeIntercaladas = parseInt(quantidadeIntercaladasInput.value) || 0;
            const total = valorIntercaladas * quantidadeIntercaladas;
            totalIntercaladasSpan.textContent = formatCurrencyDisplay(total);
            return total;
        }

        function getFormattedValues() {
            return {
                nomeCliente: nomeClienteInput.value.trim() || 'Não informado',
                telefoneCliente: formatPhoneNumberForOutput(telefoneClienteInput.value.trim()),
                nomeEmpreendimento: nomeEmpreendimentoInput.value.trim() || 'Não informado',
                valorImovel: formatCurrencyDisplay(cleanCurrencyFormat(valorImovelInput.value)),
                descontoMCMV: formatCurrencyDisplay(cleanCurrencyFormat(descontoMCMVInput.value)),
                valorFinanciado: formatCurrencyDisplay(cleanCurrencyFormat(valorFinanciadoInput.value)),
                descontoConstrutora: formatCurrencyDisplay(cleanCurrencyFormat(descontoConstrutoraInput.value)),
                valorFGTS: formatCurrencyDisplay(cleanCurrencyFormat(valorFGTSInput.value)),
                sinalConstrutora: formatCurrencyDisplay(cleanCurrencyFormat(sinalConstrutoraInput.value)),
                maximoConstrParc: formatCurrencyDisplay(cleanCurrencyFormat(maximoConstrParcInput.value)),
                parcelasEntrada: parcelasEntradaInput.value,
                correcaoINCC: correcaoINCCInput.value + '%',
                saldoRemanescente: saldoRemanescenteSpan.textContent,
                valorParcelaEntradaInicial: valorParcelaEntradaInicialSpan.textContent,
                valorIntercaladas: formatCurrencyDisplay(cleanCurrencyFormat(valorIntercaladasInput.value)),
                quantidadeIntercaladas: quantidadeIntercaladasInput.value,
                totalIntercaladas: totalIntercaladasSpan.textContent,
                notasCliente: notasClienteTextArea.value.trim(),
                observacoesSimulacao: observacoesClienteTextArea.value.trim()
            };
        }

        // Função para buscar INCC do IBGE - AGORA ONLINE
        async function fetchINCCData() {
            try {
                // Usar API do IBGE diretamente para INCC
                const response = await fetch('https://apisidra.ibge.gov.br/values/t/1736/n1/all/v/2265/p/last%201/d/v2265%2013');
                
                if (!response.ok) {
                    throw new Error('Falha na requisição ao IBGE');
                }
                
                const data = await response.json();
                
                if (data && data.length > 1) {
                    // O primeiro item é o cabeçalho, o segundo contém os dados
                    const ultimoValor = parseFloat(data[1].V);
                    const periodo = data[1].D3N; // Ex: "janeiro 2024"
                    
                    if (!isNaN(ultimoValor)) {
                        // Atualizar interface
                        inccCurrentValue.textContent = `${ultimoValor.toFixed(2)}%`;
                        inccUpdateTime.textContent = `Período: ${periodo}`;
                        inccLoading.style.display = 'none';
                        
                        // Armazenar no localStorage
                        localStorage.setItem('lastINCCValue', ultimoValor.toString());
                        localStorage.setItem('lastINCCDate', periodo);
                        localStorage.setItem('lastINCCUpdate', new Date().toISOString());
                        
                        // Sugerir valor no campo de INCC se estiver em 0
                        if (parseFloat(correcaoINCCInput.value) === 0) {
                            correcaoINCCInput.value = ultimoValor.toFixed(2);
                            calcularValores();
                        }
                        
                        return ultimoValor;
                    }
                }
                
                throw new Error('Dados não disponíveis');
            } catch (error) {
                console.error('Erro ao buscar INCC:', error);
                
                // Fallback para API alternativa
                try {
                    const fallbackResponse = await fetch('https://api.bcb.gov.br/dados/serie/bcdata.sgs.11428/dados/ultimos/1?formato=json');
                    if (fallbackResponse.ok) {
                        const fallbackData = await fallbackResponse.json();
                        if (fallbackData && fallbackData[0]) {
                            const ultimoValor = parseFloat(fallbackData[0].valor);
                            const data = fallbackData[0].data;
                            
                            inccCurrentValue.textContent = `${ultimoValor.toFixed(2)}%`;
                            inccUpdateTime.textContent = `Data: ${data}`;
                            inccLoading.style.display = 'none';
                            
                            localStorage.setItem('lastINCCValue', ultimoValor.toString());
                            localStorage.setItem('lastINCCDate', data);
                            
                            if (parseFloat(correcaoINCCInput.value) === 0) {
                                correcaoINCCInput.value = ultimoValor.toFixed(2);
                                calcularValores();
                            }
                            
                            return ultimoValor;
                        }
                    }
                } catch (fallbackError) {
                    console.error('Fallback também falhou:', fallbackError);
                }
                
                // Tentar usar dados armazenados localmente
                const lastINCC = localStorage.getItem('lastINCCValue');
                const lastINCCDate = localStorage.getItem('lastINCCDate');
                
                if (lastINCC) {
                    inccCurrentValue.textContent = `${parseFloat(lastINCC).toFixed(2)}%`;
                    inccUpdateTime.textContent = `Último conhecido: ${lastINCCDate || 'N/D'}`;
                    inccLoading.style.display = 'none';
                    
                    if (parseFloat(correcaoINCCInput.value) === 0) {
                        correcaoINCCInput.value = parseFloat(lastINCC).toFixed(2);
                        calcularValores();
                    }
                    
                    return parseFloat(lastINCC);
                } else {
                    // Valor padrão se não conseguir buscar
                    inccCurrentValue.textContent = '0,55% (padrão)';
                    inccUpdateTime.textContent = 'Dados offline';
                    inccLoading.style.display = 'none';
                    
                    if (parseFloat(correcaoINCCInput.value) === 0) {
                        correcaoINCCInput.value = '0.55';
                        calcularValores();
                    }
                    
                    return 0.55;
                }
            }
        }

        // Função para gerar PDF profissional
        async function gerarResumoPDF() {
            showToast('Gerando resumo em PDF...', 'info', 3000);
            
            const data = getFormattedValues();
            const dataAtual = new Date().toLocaleDateString('pt-BR');
            const horaAtual = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            
            try {
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const margin = 15;
                let yPos = margin;
                
                // Cabeçalho
                pdf.setFillColor(41, 128, 185);
                pdf.rect(0, 0, pageWidth, 25, 'F');
                
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(20);
                pdf.setFont('helvetica', 'bold');
                pdf.text('RESUMO DA SIMULAÇÃO', pageWidth / 2, 15, { align: 'center' });
                
                pdf.setFontSize(10);
                pdf.text(`Gerado em: ${dataAtual} às ${horaAtual}`, pageWidth / 2, 22, { align: 'center' });
                
                yPos = 35;
                
                // Informações do cliente
                pdf.setTextColor(0, 0, 0);
                pdf.setFontSize(14);
                pdf.setFont('helvetica', 'bold');
                pdf.text('INFORMAÇÕES DO CLIENTE', margin, yPos);
                
                pdf.setDrawColor(41, 128, 185);
                pdf.setLineWidth(0.5);
                pdf.line(margin, yPos + 2, pageWidth - margin, yPos + 2);
                
                yPos += 10;
                
                pdf.setFontSize(11);
                pdf.setFont('helvetica', 'normal');
                pdf.text(`Nome: ${data.nomeCliente}`, margin, yPos);
                pdf.text(`Telefone: ${data.telefoneCliente}`, pageWidth / 2, yPos);
                yPos += 7;
                pdf.text(`Empreendimento: ${data.nomeEmpreendimento}`, margin, yPos);
                yPos += 10;
                
                // Valores do imóvel
                pdf.setFontSize(14);
                pdf.setFont('helvetica', 'bold');
                pdf.text('VALORES DO IMÓVEL', margin, yPos);
                pdf.line(margin, yPos + 2, pageWidth - margin, yPos + 2);
                
                yPos += 10;
                
                pdf.setFontSize(11);
                pdf.setFont('helvetica', 'normal');
                
                const valores = [
                    ['Valor do Imóvel:', data.valorImovel],
                    ['Desconto (Subsídio):', data.descontoMCMV],
                    ['Desconto Construtora:', data.descontoConstrutora],
                    ['FGTS:', data.valorFGTS],
                    ['Valor Financiado:', data.valorFinanciado]
                ];
                
                valores.forEach(item => {
                    pdf.text(item[0], margin, yPos);
                    pdf.text(item[1], pageWidth - margin - 40, yPos, { align: 'right' });
                    yPos += 6;
                });
                
                yPos += 5;
                
                // Entrada
                pdf.setFontSize(14);
                pdf.setFont('helvetica', 'bold');
                pdf.text('ENTRADA', margin, yPos);
                pdf.line(margin, yPos + 2, pageWidth - margin, yPos + 2);
                
                yPos += 10;
                
                pdf.setFontSize(11);
                pdf.setFont('helvetica', 'normal');
                
                const entrada = [
                    ['Sinal para Construtora:', data.sinalConstrutora],
                    ['Valor Parcelado:', data.maximoConstrParc],
                    ['Parcelas:', `${data.parcelasEntrada}x`],
                    ['Correção INCC:', data.correcaoINCC],
                    ['1ª Parcela:', data.valorParcelaEntradaInicial]
                ];
                
                entrada.forEach(item => {
                    pdf.text(item[0], margin, yPos);
                    pdf.text(item[1], pageWidth - margin - 40, yPos, { align: 'right' });
                    yPos += 6;
                });
                
                yPos += 5;
                
                // Intercaladas
                if (cleanCurrencyFormat(data.valorIntercaladas) > 0 && parseInt(data.quantidadeIntercaladas) > 0) {
                    pdf.setFontSize(14);
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('INTERCALADAS', margin, yPos);
                    pdf.line(margin, yPos + 2, pageWidth - margin, yPos + 2);
                    
                    yPos += 10;
                    
                    pdf.setFontSize(11);
                    pdf.setFont('helvetica', 'normal');
                    
                    const intercaladas = [
                        ['Valor das Intercaladas:', data.valorIntercaladas],
                        ['Quantidade:', data.quantidadeIntercaladas],
                        ['Total:', data.totalIntercaladas]
                    ];
                    
                    intercaladas.forEach(item => {
                        pdf.text(item[0], margin, yPos);
                        pdf.text(item[1], pageWidth - margin - 40, yPos, { align: 'right' });
                        yPos += 6;
                    });
                    
                    yPos += 5;
                }
                
                // Resumo financeiro em destaque
                pdf.setFillColor(240, 248, 255);
                pdf.roundedRect(margin - 2, yPos - 2, pageWidth - 2 * margin + 4, 30, 3, 3, 'F');
                
                pdf.setFontSize(14);
                pdf.setFont('helvetica', 'bold');
                pdf.setTextColor(41, 128, 185);
                pdf.text('RESUMO FINANCEIRO', margin, yPos);
                
                yPos += 10;
                
                pdf.setFontSize(12);
                pdf.setTextColor(0, 0, 0);
                pdf.text('Saldo Remanescente:', margin, yPos);
                pdf.setFont('helvetica', 'bold');
                pdf.text(data.saldoRemanescente, pageWidth - margin - 40, yPos, { align: 'right' });
                
                yPos += 8;
                
                if (cleanCurrencyFormat(data.saldoRemanescente) > 0) {
                    pdf.setFontSize(9);
                    pdf.setFont('helvetica', 'italic');
                    pdf.setTextColor(100, 100, 100);
                    pdf.text('Esse valor ou parte dele, pode ser pago na entrega das chaves,', margin, yPos);
                    yPos += 4;
                    pdf.text('intercaladas ou de forma que a construtora aceite.', margin, yPos);
                }
                
                yPos += 15;
                
                // Observações
                if (data.observacoesSimulacao) {
                    pdf.setFontSize(14);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(0, 0, 0);
                    pdf.text('OBSERVAÇÕES', margin, yPos);
                    pdf.line(margin, yPos + 2, pageWidth - margin, yPos + 2);
                    
                    yPos += 10;
                    
                    pdf.setFontSize(10);
                    pdf.setFont('helvetica', 'normal');
                    
                    const observacoesLines = pdf.splitTextToSize(data.observacoesSimulacao, pageWidth - 2 * margin);
                    observacoesLines.forEach(line => {
                        if (yPos > pageHeight - 20) {
                            pdf.addPage();
                            yPos = margin;
                        }
                        pdf.text(line, margin, yPos);
                        yPos += 5;
                    });
                    
                    yPos += 5;
                }
                
                // Nota sobre correção
                yPos = pageHeight - 25;
                pdf.setFontSize(8);
                pdf.setFont('helvetica', 'italic');
                pdf.setTextColor(100, 100, 100);
                pdf.text('* O valor das parcelas de entrada é corrigido mensalmente pelo INCC e após a obra pelo IPCA mais 1%.', 
                        pageWidth / 2, yPos, { align: 'center' });
                yPos += 4;
                pdf.text('** Valores sujeitos a alteração e aprovação. Esta é uma simulação preliminar.', 
                        pageWidth / 2, yPos, { align: 'center' });
                
                // Rodapé
                pdf.setFontSize(7);
                pdf.setTextColor(150, 150, 150);
                pdf.text(`Simulador de Plano de Pagamento - Desenvolvido por Alex Peixoto - (82) 996622036`, 
                        pageWidth / 2, pageHeight - 10, { align: 'center' });
                
                // Salvar PDF
                const nomeArquivo = `Resumo_${data.nomeCliente.replace(/\s+/g, '_')}_${dataAtual.replace(/\//g, '-')}.pdf`;
                pdf.save(nomeArquivo);
                
                showToast('Resumo PDF baixado com sucesso!', 'success');
                
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                showToast('Erro ao gerar PDF. Tente novamente.', 'danger');
            }
        }

        // Função para gerar PDF da lista de leads
        async function gerarListaLeadsPDF() {
            showToast('Gerando lista de leads em PDF...', 'info', 3000);
            
            const leads = JSON.parse(localStorage.getItem('leads') || '[]');
            if (leads.length === 0) {
                showToast('Nenhum lead para exportar.', 'warning');
                return;
            }
            
            const dataAtual = new Date().toLocaleDateString('pt-BR');
            const horaAtual = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            
            try {
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const margin = 15;
                let yPos = margin;
                
                // Cabeçalho
                pdf.setFillColor(41, 128, 185);
                pdf.rect(0, 0, pageWidth, 25, 'F');
                
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(20);
                pdf.setFont('helvetica', 'bold');
                pdf.text('LISTA DE LEADS', pageWidth / 2, 15, { align: 'center' });
                
                pdf.setFontSize(10);
                pdf.text(`Gerado em: ${dataAtual} às ${horaAtual} | Total: ${leads.length} leads`, pageWidth / 2, 22, { align: 'center' });
                
                yPos = 35;
                
                // Tabela de leads
                pdf.setTextColor(0, 0, 0);
                pdf.setFontSize(12);
                pdf.setFont('helvetica', 'bold');
                
                // Cabeçalho da tabela
                const colWidths = [30, 25, 30, 15, 20, 20, 15, 15, 20];
                const headers = ['Nome', 'Telefone', 'Empreendimento', 'Data', 'Subsídio', 'Financiado', 'FGTS', 'Notas', 'Obs.'];
                
                // Desenhar cabeçalho
                let xPos = margin;
                headers.forEach((header, index) => {
                    pdf.setFillColor(240, 240, 240);
                    pdf.rect(xPos, yPos, colWidths[index], 8, 'F');
                    pdf.text(header, xPos + 2, yPos + 5);
                    xPos += colWidths[index];
                });
                
                yPos += 10;
                
                // Dados dos leads
                pdf.setFontSize(9);
                pdf.setFont('helvetica', 'normal');
                
                leads.forEach((lead, leadIndex) => {
                    // Verificar se precisa de nova página
                    if (yPos > pageHeight - 20) {
                        pdf.addPage();
                        yPos = margin;
                        
                        // Redesenhar cabeçalho
                        xPos = margin;
                        headers.forEach((header, index) => {
                            pdf.setFillColor(240, 240, 240);
                            pdf.rect(xPos, yPos, colWidths[index], 8, 'F');
                            pdf.setFont('helvetica', 'bold');
                            pdf.text(header, xPos + 2, yPos + 5);
                            xPos += colWidths[index];
                        });
                        yPos += 10;
                        pdf.setFont('helvetica', 'normal');
                    }
                    
                    // Dados do lead
                    const rowData = [
                        lead.nome?.substring(0, 15) || '',
                        lead.telefone || '',
                        lead.empreendimento?.substring(0, 15) || '',
                        lead.data || '',
                        lead.subsidio || '',
                        lead.financiado || '',
                        lead.fgts || '',
                        lead.notas ? 'Sim' : 'Não',
                        lead.observacoes ? 'Sim' : 'Não'
                    ];
                    
                    xPos = margin;
                    rowData.forEach((cell, cellIndex) => {
                        pdf.text(cell.substring(0, 15), xPos + 2, yPos + 4);
                        xPos += colWidths[cellIndex];
                    });
                    
                    yPos += 6;
                    
                    // Linha divisória
                    if (leadIndex < leads.length - 1) {
                        pdf.setDrawColor(200, 200, 200);
                        pdf.line(margin, yPos - 1, pageWidth - margin, yPos - 1);
                    }
                });
                
                // Resumo
                yPos += 10;
                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'bold');
                pdf.text('RESUMO GERAL', margin, yPos);
                
                yPos += 7;
                pdf.setFontSize(9);
                pdf.setFont('helvetica', 'normal');
                pdf.text(`Total de Leads: ${leads.length}`, margin, yPos);
                yPos += 4;
                
                const leadsComNotas = leads.filter(lead => lead.notas && lead.notas.trim() !== '').length;
                pdf.text(`Leads com notas: ${leadsComNotas}`, margin, yPos);
                yPos += 4;
                
                const leadsComObservacoes = leads.filter(lead => lead.observacoes && lead.observacoes.trim() !== '').length;
                pdf.text(`Leads com observações: ${leadsComObservacoes}`, margin, yPos);
                
                // Rodapé
                pdf.setFontSize(7);
                pdf.setTextColor(150, 150, 150);
                pdf.text(`Simulador de Plano de Pagamento - Desenvolvido por Alex Peixoto - (82) 996622036`, 
                        pageWidth / 2, pageHeight - 10, { align: 'center' });
                
                // Salvar PDF
                const nomeArquivo = `Lista_Leads_${dataAtual.replace(/\//g, '-')}.pdf`;
                pdf.save(nomeArquivo);
                
                showToast('Lista de leads exportada em PDF com sucesso!', 'success');
                
            } catch (error) {
                console.error('Erro ao gerar PDF de leads:', error);
                showToast('Erro ao gerar PDF. Tente novamente.', 'danger');
            }
        }

        // Função principal de cálculo
        function calcularValores() {
            const valorImovel = cleanCurrencyFormat(valorImovelInput.value) || 0;
            const descontoMCMV = cleanCurrencyFormat(descontoMCMVInput.value) || 0;
            const valorFinanciado = cleanCurrencyFormat(valorFinanciadoInput.value) || 0;
            const descontoConstrutora = cleanCurrencyFormat(descontoConstrutoraInput.value) || 0;
            const valorFGTS = cleanCurrencyFormat(valorFGTSInput.value) || 0;
            const sinalConstrutora = cleanCurrencyFormat(sinalConstrutoraInput.value) || 0;
            const maximoConstrParc = cleanCurrencyFormat(maximoConstrParcInput.value) || 0;
            const parcelasEntrada = parseInt(parcelasEntradaInput.value) || 1;
            const correcaoINCC = parseFloat(correcaoINCCInput.value) || 0;
            const valorEntradaCalculadoNumerico = valorImovel - descontoMCMV - valorFinanciado - valorFGTS - descontoConstrutora;

            const totalIntercaladas = calcularIntercaladas();
            const saldoRemanescenteCalculado = valorEntradaCalculadoNumerico - sinalConstrutora - maximoConstrParc - totalIntercaladas;
            
            saldoRemanescenteSpan.textContent = formatCurrencyDisplay(saldoRemanescenteCalculado);
            
            const existingNote = saldoRemanescenteSpan.parentElement.querySelector('.saldo-remanescente-note');
            if(existingNote) {
                existingNote.remove();
            }

            if (saldoRemanescenteCalculado > 0.00) {
                const noteElement = document.createElement('span');
                noteElement.classList.add('saldo-remanescente-note');
                noteElement.textContent = 'Esse valor ou parte dele, pode ser pago na entrega das chaves, intercaladas ou de forma que a construtora aceite.';
                saldoRemanescenteSpan.parentElement.appendChild(noteElement);
            }

            let valorParcelaSemINCC = parcelasEntrada > 0 ? maximoConstrParc / parcelasEntrada : 0;
            let valorParcelaEntradaInicialCalc = valorParcelaSemINCC;

            if (correcaoINCC > 0 && parcelasEntrada > 0 && maximoConstrParc > 0) {
                const correcaoMensalSobreParcelaBase = valorParcelaSemINCC * (correcaoINCC / 100);
                valorParcelaEntradaInicialCalc = valorParcelaSemINCC + correcaoMensalSobreParcelaBase;
            } else if (maximoConstrParc === 0 && parcelasEntrada > 0) {
                valorParcelaEntradaInicialCalc = 0;
            }
            
            valorParcelaEntradaInicialSpan.textContent = formatCurrencyDisplay(valorParcelaEntradaInicialCalc);
        }

        // Função para limpar formulário
        function limparFormularioNovaSimulacao() {
            nomeEmpreendimentoInput.value = '';
            nomeClienteInput.value = '';
            telefoneClienteInput.value = '';
            parcelasEntradaInput.value = '1';
            
            const camposMoedaParaLimpar = [
                valorImovelInput,
                descontoMCMVInput,
                valorFinanciadoInput,
                descontoConstrutoraInput,
                valorFGTSInput,
                sinalConstrutoraInput,
                maximoConstrParcInput,
                valorIntercaladasInput
            ];
            
            camposMoedaParaLimpar.forEach(input => {
                input.value = '0,00';
                formatInputAsCurrency({ target: input });
            });
            
            quantidadeIntercaladasInput.value = '0';
            
            if (observacoesClienteTextArea) {
                observacoesClienteTextArea.value = '';
            }
            
            if (notasClienteTextArea) {
                notasClienteTextArea.value = '';
            }

            if (notasSection && notasSection.style.display !== 'none') {
                notasSection.style.display = 'none';
                const icon = toggleNotasBtn.querySelector('i');
                const btnTextSpan = toggleNotasBtn.querySelector('.btn-text');
                if (icon) {
                    icon.classList.replace('fa-clipboard-list','fa-clipboard');
                }
                if (btnTextSpan) {
                    btnTextSpan.textContent = ' Notas Restritas';
                }
            }

            calcularValores();
            showToast('Formulário limpo para nova simulação.', 'info');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            nomeEmpreendimentoInput.focus();
        }

        // Função para carregar documentos por profissão
        function carregarDocumentosPorProfissao(profissao) {
            const documentos = {
                'carteira-assinada': [
                    'RG e CPF (cópia)',
                    'Comprovante de Residência (atual)',
                    'Carteira de Trabalho (cópia completa)',
                    '3 últimos contracheques',
                    'Declaração de rendimentos do empregador',
                    'Certidão de Casamento ou Nascimento (se casado)',
                    'Comprovante de renda do cônjuge (se casado)'
                ],
                'servidor-publico': [
                    'RG e CPF (cópia)',
                    'Comprovante de Residência (atual)',
                    'Declaração de vínculo empregatício',
                    '3 últimos contracheques ou extratos',
                    'Certidão de Casamento ou Nascimento',
                    'Comprovante de renda do cônjuge (se aplicável)'
                ],
                'empresario': [
                    'RG e CPF (cópia)',
                    'Comprovante de Residência (atual)',
                    'CNPJ da empresa (cópia)',
                    '3 últimos demonstrativos financeiros',
                    'Declaração do contador',
                    'IRPF dos últimos 3 anos',
                    'Certidão de Casamento ou Nascimento'
                ],
                'forcas-armadas': [
                    'RG e CPF (cópia)',
                    'Comprovante de Residência (atual)',
                    'Identidade militar',
                    '3 últimos contracheques',
                    'Declaração de serviço ativo',
                    'Certidão de Casamento ou Nascimento'
                ],
                'autonomo': [
                    'RG e CPF (cópia)',
                    'Comprovante de Residência (atual)',
                    'Declaração de Autônomo',
                    'IRPF dos últimos 3 anos',
                    'Comprovantes de renda (extratos bancários)',
                    'Certidão de Casamento ou Nascimento'
                ],
                'motorista-aplicativo': [
                    'RG e CPF (cópia)',
                    'Comprovante de Residência (atual)',
                    'CNH (cópia)',
                    'Extratos da plataforma (últimos 3 meses)',
                    'Comprovantes bancários',
                    'IRPF (se tiver)',
                    'Certidão de Casamento ou Nascimento'
                ],
                'pensionista': [
                    'RG e CPF (cópia)',
                    'Comprovante de Residência (atual)',
                    'Comprovante de pensão',
                    'Extratos bancários (últimos 3 meses)',
                    'Certidão de óbito do segurado (se for o caso)',
                    'Certidão de Casamento ou Nascimento'
                ]
            };

            documentosContainer.innerHTML = '';
            
            if (documentos[profissao]) {
                const section = document.createElement('div');
                section.className = 'document-section';
                section.innerHTML = `
                    <h4>Documentos Necessários para ${profissao.replace('-', ' ').toUpperCase()}</h4>
                    <ul>
                        ${documentos[profissao].map(doc => `<li><i class="fas fa-check-circle"></i> ${doc}</li>`).join('')}
                    </ul>
                `;
                documentosContainer.appendChild(section);
            }
        }

        // Função para carregar informações do PDF
        function loadPdfHeaderInfo() {
            const imobiliariaNome = localStorage.getItem('imobiliariaNome') || '';
            const corretorNome = localStorage.getItem('corretorNome') || '';
            const corretorCreci = localStorage.getItem('corretorCreci') || '';
            
            imobiliariaNomeInput.value = imobiliariaNome;
            corretorNomeInput.value = corretorNome;
            corretorCreciInput.value = corretorCreci;
            
            updatePdfHeaderInfo();
        }

        // Função para atualizar informações do PDF
        function updatePdfHeaderInfo() {
            const imobiliariaNome = imobiliariaNomeInput.value || 'Imobiliária';
            const corretorNome = corretorNomeInput.value || 'Corretor';
            const corretorCreci = corretorCreciInput.value || 'CRECI';
            
            pdfHeaderInfo.querySelector('h2').textContent = `${imobiliariaNome}`;
            pdfHeaderInfo.querySelector('p').textContent = `Corretor: ${corretorNome} - ${corretorCreci}`;
            
            // Salvar no localStorage
            localStorage.setItem('imobiliariaNome', imobiliariaNome);
            localStorage.setItem('corretorNome', corretorNome);
            localStorage.setItem('corretorCreci', corretorCreci);
        }

        // Função para atualizar contador de leads
        function updateLeadCountDisplay() {
            const leads = JSON.parse(localStorage.getItem('leads') || '[]');
            leadCountSpan.textContent = leads.length;
        }

        // Função para exportar backup
        function exportarBackup() {
            const leads = JSON.parse(localStorage.getItem('leads') || '[]');
            const notas = JSON.parse(localStorage.getItem('notasHistory') || '[]');
            const config = {
                imobiliariaNome: localStorage.getItem('imobiliariaNome'),
                corretorNome: localStorage.getItem('corretorNome'),
                corretorCreci: localStorage.getItem('corretorCreci'),
                lastINCCValue: localStorage.getItem('lastINCCValue'),
                lastINCCDate: localStorage.getItem('lastINCCDate')
            };
            
            const backupData = {
                leads: leads,
                notas: notas,
                config: config,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `backup_simulador_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('Backup exportado com sucesso!', 'success');
        }

        // Função para importar backup
        function importarBackup(file) {
            const reader = new FileReader();
            
            reader.onload = function(event) {
                try {
                    const backupData = JSON.parse(event.target.result);
                    
                    if (backupData.leads) {
                        localStorage.setItem('leads', JSON.stringify(backupData.leads));
                    }
                    
                    if (backupData.notas) {
                        localStorage.setItem('notasHistory', JSON.stringify(backupData.notas));
                    }
                    
                    if (backupData.config) {
                        if (backupData.config.imobiliariaNome) {
                            localStorage.setItem('imobiliariaNome', backupData.config.imobiliariaNome);
                        }
                        if (backupData.config.corretorNome) {
                            localStorage.setItem('corretorNome', backupData.config.corretorNome);
                        }
                        if (backupData.config.corretorCreci) {
                            localStorage.setItem('corretorCreci', backupData.config.corretorCreci);
                        }
                        if (backupData.config.lastINCCValue) {
                            localStorage.setItem('lastINCCValue', backupData.config.lastINCCValue);
                        }
                        if (backupData.config.lastINCCDate) {
                            localStorage.setItem('lastINCCDate', backupData.config.lastINCCDate);
                        }
                    }
                    
                    updateLeadCountDisplay();
                    loadPdfHeaderInfo();
                    showToast('Backup importado com sucesso!', 'success');
                    
                    if (secaoListaLeads.style.display === 'block') {
                        carregarLeadsNaTabela();
                    }
                    
                } catch (error) {
                    console.error('Erro ao importar backup:', error);
                    showToast('Erro ao importar backup. Arquivo inválido.', 'danger');
                }
            };
            
            reader.readAsText(file);
        }

        // Função para baixar simulação em TXT
        function baixarSimulacaoTXT() {
            const data = getFormattedValues();
            const dataAtual = new Date().toLocaleDateString('pt-BR');
            const horaAtual = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            
            let texto = '='.repeat(50) + '\n';
            texto += 'SIMULAÇÃO DE PLANO DE PAGAMENTO\n';
            texto += `Gerado em: ${dataAtual} às ${horaAtual}\n`;
            texto += '='.repeat(50) + '\n\n';
            
            texto += 'INFORMAÇÕES DO CLIENTE:\n';
            texto += `Nome: ${data.nomeCliente}\n`;
            texto += `Telefone: ${data.telefoneCliente}\n`;
            texto += `Empreendimento: ${data.nomeEmpreendimento}\n\n`;
            
            texto += 'VALORES DO IMÓVEL:\n';
            texto += `Valor do Imóvel: ${data.valorImovel}\n`;
            texto += `Desconto (Subsídio): ${data.descontoMCMV}\n`;
            texto += `Desconto Construtora: ${data.descontoConstrutora}\n`;
            texto += `FGTS: ${data.valorFGTS}\n`;
            texto += `Valor Financiado: ${data.valorFinanciado}\n\n`;
            
            texto += 'ENTRADA:\n';
            texto += `Sinal para Construtora: ${data.sinalConstrutora}\n`;
            texto += `Valor Parcelado: ${data.maximoConstrParc}\n`;
            texto += `Parcelas: ${data.parcelasEntrada}x\n`;
            texto += `Correção INCC: ${data.correcaoINCC}\n`;
            texto += `1ª Parcela: ${data.valorParcelaEntradaInicial}\n\n`;
            
            if (cleanCurrencyFormat(data.valorIntercaladas) > 0 && parseInt(data.quantidadeIntercaladas) > 0) {
                texto += 'INTERCALADAS:\n';
                texto += `Valor: ${data.valorIntercaladas}\n`;
                texto += `Quantidade: ${data.quantidadeIntercaladas}\n`;
                texto += `Total: ${data.totalIntercaladas}\n\n`;
            }
            
            texto += 'RESUMO FINANCEIRO:\n';
            texto += `Saldo Remanescente: ${data.saldoRemanescente}\n`;
            
            if (cleanCurrencyFormat(data.saldoRemanescente) > 0) {
                texto += 'Nota: Esse valor ou parte dele, pode ser pago na entrega das chaves, intercaladas ou de forma que a construtora aceite.\n\n';
            }
            
            if (data.observacoesSimulacao) {
                texto += 'OBSERVAÇÕES:\n';
                texto += `${data.observacoesSimulacao}\n\n`;
            }
            
            texto += 'NOTAS:\n';
            texto += `${data.notasCliente || 'Nenhuma nota adicionada.'}\n\n`;
            
            texto += '-' .repeat(50) + '\n';
            texto += 'O valor das parcelas de entrada é corrigido mensalmente pelo INCC e após a obra pelo IPCA mais 1%.\n';
            texto += 'Valores sujeitos a alteração e aprovação. Esta é uma simulação preliminar.\n';
            texto += '-' .repeat(50) + '\n\n';
            texto += 'Desenvolvido por Alex Peixoto - (82) 996622036\n';
            
            const blob = new Blob([texto], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `simulacao_${data.nomeCliente.replace(/\s+/g, '_')}_${dataAtual.replace(/\//g, '-')}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showToast('Simulação baixada em TXT com sucesso!', 'success');
        }

        // Função para baixar lista de leads
        function baixarListaLeads() {
            const leads = JSON.parse(localStorage.getItem('leads') || '[]');
            if (leads.length === 0) {
                showToast('Nenhum lead para exportar.', 'warning');
                return;
            }
            
            let csv = 'Nome,Telefone,Empreendimento,Data,Subsídio,Financiado,FGTS,Notas,Observações\n';
            
            leads.forEach(lead => {
                csv += `"${lead.nome || ''}","${lead.telefone || ''}","${lead.empreendimento || ''}","${lead.data || ''}","${lead.subsidio || ''}","${lead.financiado || ''}","${lead.fgts || ''}","${lead.notas || ''}","${lead.observacoes || ''}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `lista_leads_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showToast('Lista de leads exportada em CSV!', 'success');
        }

        // Função para carregar leads na tabela
        function carregarLeadsNaTabela() {
            const leads = JSON.parse(localStorage.getItem('leads') || '[]');
            corpoTabelaLeads.innerHTML = '';
            
            if (leads.length === 0) {
                semLeadsMensagem.style.display = 'block';
                tabelaLeadsElement.style.display = 'none';
            } else {
                semLeadsMensagem.style.display = 'none';
                tabelaLeadsElement.style.display = 'table';
                
                leads.forEach((lead, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${lead.nome || ''}</td>
                        <td>${lead.telefone || ''}</td>
                        <td>${lead.empreendimento || ''}</td>
                        <td>${lead.data || ''}</td>
                        <td>${lead.subsidio || ''}</td>
                        <td>${lead.financiado || ''}</td>
                        <td>${lead.fgts || ''}</td>
                        <td>${lead.notas ? 'Sim' : 'Não'}</td>
                        <td>${lead.observacoes ? (lead.observacoes.length > 50 ? lead.observacoes.substring(0, 50) + '...' : lead.observacoes) : ''}</td>
                        <td style="text-align: center;">
                            <button class="btn btn-danger btn-auto-width" onclick="excluirLead(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    corpoTabelaLeads.appendChild(row);
                });
            }
            
            updateLeadCountDisplay();
        }

        // Função para excluir lead
        window.excluirLead = function(index) {
            if (confirm('Tem certeza que deseja excluir este lead?')) {
                const leads = JSON.parse(localStorage.getItem('leads') || '[]');
                leads.splice(index, 1);
                localStorage.setItem('leads', JSON.stringify(leads));
                carregarLeadsNaTabela();
                showToast('Lead excluído com sucesso!', 'success');
            }
        };

        // Função para salvar lead
        function salvarLead() {
            const data = getFormattedValues();
            
            if (!data.nomeCliente || data.nomeCliente === 'Não informado') {
                showToast('Preencha o nome do cliente para salvar o lead.', 'warning');
                return;
            }
            
            const lead = {
                nome: data.nomeCliente,
                telefone: telefoneClienteInput.value.replace(/\D/g, ''),
                empreendimento: data.nomeEmpreendimento,
                data: new Date().toLocaleDateString('pt-BR'),
                subsidio: data.descontoMCMV,
                financiado: data.valorFinanciado,
                fgts: data.valorFGTS,
                notas: data.notasCliente,
                observacoes: data.observacoesSimulacao
            };
            
            const leads = JSON.parse(localStorage.getItem('leads') || '[]');
            leads.push(lead);
            localStorage.setItem('leads', JSON.stringify(leads));
            
            updateLeadCountDisplay();
            showToast('Lead salvo com sucesso!', 'success');
        }

        // Função para gerar conteúdo WhatsApp
        function gerarConteudoSimulacaoWhatsApp() {
            const data = getFormattedValues();
            const saldoRemanescenteNumerico = cleanCurrencyFormat(saldoRemanescenteSpan.textContent);
            let msg = `*Simulação de Plano de Pagamento*%0A%0A`;
            msg += `*Cliente:* ${data.nomeCliente}%0A`;
            if (data.telefoneCliente !== 'Não Informado' && data.telefoneCliente !== '(Formato Inválido)') {
                msg += `*Telefone:* ${data.telefoneCliente}%0A`;
            }
            msg += `*Empreendimento:* ${data.nomeEmpreendimento}%0A%0A`;
            msg += `*Plano de Pagamento:*%0A`;
            msg += `Valor do Imóvel (Tabela,Construtora): ${data.valorImovel}%0A`;
            if (cleanCurrencyFormat(data.descontoMCMV) > 0) msg += `Desconto (Subsídio): ${data.descontoMCMV}%0A`;
            if (cleanCurrencyFormat(data.descontoConstrutora) > 0) msg += `Desconto Construtora: ${data.descontoConstrutora}%0A`;
            if (cleanCurrencyFormat(data.valorFGTS) > 0) msg += `FGTS: ${data.valorFGTS}%0A`;
            msg += `Valor Financiado (Caixa): ${data.valorFinanciado}%0A%0A`;

            msg += `*(Sinal, Decontos, Parcelamento):*%0A`;
            if (cleanCurrencyFormat(data.sinalConstrutora) > 0) msg += `  Sinal: ${data.sinalConstrutora}%0A`;
            msg += `  Parcelado Construtora: ${data.maximoConstrParc} em ${data.parcelasEntrada}x%0A`;
            msg += `  *1ª Parcela (com INCC ${data.correcaoINCC}):* ${data.valorParcelaEntradaInicial}%0A`;
            
            if (cleanCurrencyFormat(data.valorIntercaladas) > 0 && data.quantidadeIntercaladas > 0) {
                msg += `%0A*Intercaladas:*%0A`;
                msg += `  Valor: ${data.valorIntercaladas}%0A`;
                msg += `  Quantidade: ${data.quantidadeIntercaladas}%0A`;
                msg += `  Total: ${data.totalIntercaladas}%0A`;
            }
            
            if (saldoRemanescenteNumerico > 0.00) {
                msg += `  Saldo Remanescente: ${data.saldoRemanescente}%0A`;
                msg += `  _Esse valor ou parte dele, pode ser pago na entrega das chaves, intercaladas ou de forma que a construtora aceite._%0A`;
            } else {
                msg += `  Saldo Remanescente: ${data.saldoRemanescente}%0A`;
            }
            
            msg += `%0A${encodeURIComponent("O valor das parcelas de entrada é corrigido mensalmente pelo INCC e após a obra pelo IPCA mais 1%.")}%0A`;
            
            if (data.observacoesSimulacao) {
                msg += `%0A*OBSERVACÕES DA SIMULAÇÃO:*%0A${encodeURIComponent(data.observacoesSimulacao)}`;
            }

            msg += `%0A%0A*Atenção:* Simulação sujeita a alterações e aprovação.`;
            return msg;
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar formatação de moeda
            currencyInputs.forEach(input => {
                input.addEventListener('input', formatInputAsCurrency);
                input.addEventListener('blur', formatInputAsCurrency);
                formatInputAsCurrency({ target: input });
            });
            
            // Inicializar formatação de telefone
            telefoneClienteInput.addEventListener('input', formatInputAsPhone);
            
            // Inicializar cálculo
            calcularValores();
            
            // Event listeners para inputs que disparam cálculo
            const inputsParaCalcular = [
                valorImovelInput, descontoMCMVInput, valorFinanciadoInput,
                descontoConstrutoraInput, valorFGTSInput, sinalConstrutoraInput,
                maximoConstrParcInput, parcelasEntradaInput, correcaoINCCInput,
                valorIntercaladasInput, quantidadeIntercaladasInput
            ];
            
            inputsParaCalcular.forEach(input => {
                input.addEventListener('input', calcularValores);
            });
            
            // Botão nova simulação
            btnNovaSimulacao.addEventListener('click', limparFormularioNovaSimulacao);
            
            // Botão PDF
            btnBaixarResumoPDF.addEventListener('click', () => {
                gerarResumoPDF();
                salvarLead();
            });
            
            // Botão WhatsApp
            enviarWhatsappBtn.addEventListener('click', () => {
                const mensagem = gerarConteudoSimulacaoWhatsApp();
                const telefoneCorretor = "5582996622036";
                const url = `https://wa.me/${telefoneCorretor}?text=${encodeURIComponent(mensagem)}`;
                window.open(url, '_blank');
            });
            
            // Botão baixar TXT
            baixarSimulacaoAtualBtn.addEventListener('click', baixarSimulacaoTXT);
            
            // Toggle notas
            toggleNotasBtn.addEventListener('click', () => {
                const isVisible = notasSection.style.display === 'block';
                notasSection.style.display = isVisible ? 'none' : 'block';
                const icon = toggleNotasBtn.querySelector('i');
                const btnTextSpan = toggleNotasBtn.querySelector('.btn-text');
                
                if (isVisible) {
                    icon.classList.replace('fa-clipboard-list', 'fa-clipboard');
                    btnTextSpan.textContent = ' Notas Restritas';
                } else {
                    icon.classList.replace('fa-clipboard', 'fa-clipboard-list');
                    btnTextSpan.textContent = ' Fechar Notas';
                }
            });
            
            // Botão abrir lista de leads
            btnAbrirListaLeads.addEventListener('click', () => {
                simuladorCardElement.style.display = 'none';
                secaoListaLeads.style.display = 'block';
                carregarLeadsNaTabela();
            });
            
            // Botão voltar para simulador
            btnVoltarSimulador.addEventListener('click', () => {
                secaoListaLeads.style.display = 'none';
                simuladorCardElement.style.display = 'block';
            });
            
            // Botão documentos
            btnDocumentos.addEventListener('click', () => {
                documentsModal.classList.add('show');
            });
            
            // Botão baixar lista de leads
            btnBaixarListaLeads.addEventListener('click', baixarListaLeads);
            
            // Botão baixar lista de leads em PDF
            btnBaixarListaLeadsPDF.addEventListener('click', gerarListaLeadsPDF);
            
            // Botão importar leads CSV
            btnImportarLeadsCSV.addEventListener('click', () => {
                importLeadsCSVFileInput.click();
            });
            
            importLeadsCSVFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const csv = event.target.result;
                        const lines = csv.split('\n');
                        const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                        const leads = [];
                        
                        for (let i = 1; i < lines.length; i++) {
                            if (lines[i].trim() === '') continue;
                            
                            const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                            const lead = {};
                            
                            headers.forEach((header, index) => {
                                lead[header.toLowerCase()] = values[index] || '';
                            });
                            
                            leads.push(lead);
                        }
                        
                        const existingLeads = JSON.parse(localStorage.getItem('leads') || '[]');
                        const allLeads = [...existingLeads, ...leads];
                        localStorage.setItem('leads', JSON.stringify(allLeads));
                        
                        carregarLeadsNaTabela();
                        showToast(`${leads.length} leads importados do CSV!`, 'success');
                        importLeadsCSVFileInput.value = '';
                    };
                    reader.readAsText(file);
                }
            });
            
            // Botão importar leads JSON
            btnImportarLeads.addEventListener('click', () => {
                importLeadsFileInput.click();
            });
            
            importLeadsFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const importedLeads = JSON.parse(event.target.result);
                            const existingLeads = JSON.parse(localStorage.getItem('leads') || '[]');
                            const allLeads = [...existingLeads, ...importedLeads];
                            localStorage.setItem('leads', JSON.stringify(allLeads));
                            
                            carregarLeadsNaTabela();
                            showToast(`${importedLeads.length} leads importados do JSON!`, 'success');
                            importLeadsFileInput.value = '';
                        } catch (error) {
                            showToast('Erro ao importar arquivo JSON.', 'danger');
                        }
                    };
                    reader.readAsText(file);
                }
            });
            
            // Botões de backup
            btnExportarBackup.addEventListener('click', exportarBackup);
            
            btnImportarBackup.addEventListener('click', () => {
                importFileInput.click();
            });
            
            importFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    importarBackup(file);
                    importFileInput.value = '';
                }
            });
            
            // Fechar modais
            closeModalBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const target = btn.getAttribute('data-target');
                    if (target) {
                        document.querySelector(target).classList.remove('show');
                    } else {
                        confirmationModal.classList.remove('show');
                    }
                });
            });
            
            // Fechar modal ao clicar fora
            window.addEventListener('click', (e) => {
                if (e.target === documentsModal) {
                    documentsModal.classList.remove('show');
                }
                if (e.target === historyModal) {
                    historyModal.classList.remove('show');
                }
                if (e.target === confirmationModal) {
                    confirmationModal.classList.remove('show');
                }
            });
            
            // Atualizar informações do PDF quando mudar
            [imobiliariaNomeInput, corretorNomeInput, corretorCreciInput].forEach(input => {
                input.addEventListener('input', updatePdfHeaderInfo);
            });
            
            // Mudar documentos quando mudar profissão
            profissaoClienteSelect.addEventListener('change', (e) => {
                carregarDocumentosPorProfissao(e.target.value);
            });
            
            // Inicializar dados
            loadPdfHeaderInfo();
            carregarDocumentosPorProfissao('carteira-assinada');
            fetchINCCData();
            updateLeadCountDisplay();
            
            // Atualizar INCC a cada hora
            setInterval(fetchINCCData, 3600000);
        });

    </script>
</body>
</html>
